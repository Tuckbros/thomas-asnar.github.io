<link rel="import" href="polymer-element.df8b0c9d.html"><link rel="import" href="paper-input.3727ccfa.html"><link rel="import" href="iron-icons.6c232d02.html"><link rel="import" href="ta-clock.3d6a3f1c.html"><link rel="import" href="moment.ac068f3d.html"><dom-module id="cd-itime"> <template> <style>iron-input[invalid]>input{border:1px solid red;background-color:#ffcdd2}.pointages{float:left}.pointages h3{margin-top:2px}.clocks{float:left;margin:0 50px;text-align:center}</style> <div class="clocks"> <ta-clock clock-type="h-fin" clock-sub-title="{{hDureeJTrav}}h{{mDureeJTrav}} + {{intervalDej}} min dej'" clock-title="Heure de fin théorique" clock-value="{{clockHFin}}"></ta-clock> <br> <ta-clock clock-type="h-fin-compteur-duration" clock-sub-title="Difference avec l'heure de sortie théorique" clock-title="Compteur fin de journée" clock-value="{{clockHFinCompteur}}"></ta-clock> </div> <div class="pointages"> <h3>Mouvements Pointages</h3> <paper-input id="input-am-in" always-float-label="" pattern="[0-2]{0,1}[0-9]:[0-5]{0,1}[0-9]" allowed-pattern="[0-9:]" placeholder="HH:MM" auto-validate="" label="AM in"> <iron-icon icon="icons:chevron-left" slot="prefix"></iron-icon> </paper-input> <br> <paper-input id="input-am-out" always-float-label="" pattern="[0-2]{0,1}[0-9]:[0-5]{0,1}[0-9]" allowed-pattern="[0-9:]" placeholder="HH:MM" auto-validate="" label="AM out"> <iron-icon icon="icons:chevron-right" slot="suffix"></iron-icon> </paper-input> <br> <paper-input id="input-pm-in" always-float-label="" pattern="[0-2]{0,1}[0-9]:[0-5]{0,1}[0-9]" allowed-pattern="[0-9:]" placeholder="HH:MM" auto-validate="" label="PM in"> <iron-icon icon="icons:chevron-left" slot="prefix"></iron-icon> </paper-input> <br> <paper-input id="input-pm-out" always-float-label="" pattern="[0-2]{0,1}[0-9]:[0-5]{0,1}[0-9]" allowed-pattern="[0-9:]" placeholder="HH:MM" auto-validate="" label="PM out"> <iron-icon icon="icons:chevron-right" slot="suffix"></iron-icon> </paper-input> <br> </div> <div class="clocks"> <ta-clock clock-type="now" clock-title="Heure courante"></ta-clock> <br> <paper-input id="duree-travail-journee" always-float-label="" pattern="[0-2]{0,1}[0-9]:[0-5]{0,1}[0-9]" allowed-pattern="[0-9:]" auto-validate="" label="Duree d'une journée de travail" value="{{observedDureeJTrav}}"> </paper-input> </div> </template> <script>class CdItime extends(Polymer.mixinBehaviors([Polymer.IronValidatableBehavior],Polymer.Element)){static get is(){return"cd-itime"}static get properties(){return{clockHFin:Number,clockHFinCompteur:Number,intervalDejMin:{type:Number,value:30},intervalDej:{type:Number,value:30},hDureeJTrav:{type:Number,value:7},mDureeJTrav:{type:Number,value:48},observedDureeJTrav:{type:String,observer:"_onChangeDureeJTrav"},momentAmIn:Object,momentAmOut:Object,momentPmIn:Object,momentPmOut:Object,momentClockHFin:Object}}_onChangeDureeJTrav(t,e){let i=this._momentSplitColon(t);void 0!=i&&i._isValid&&(this.hDureeJTrav=i.hours(),this.mDureeJTrav=i.minutes(),this.shadowRoot.querySelector("#input-am-in").validate())}_momentSplitColon(t){let e=void 0;try{e=moment().hours(t.split(":")[0]).minutes(t.split(":")[1]).seconds(0).milliseconds(0)}finally{return e}}ready(){super.ready(),this.observedDureeJTrav=this.hDureeJTrav+":"+this.mDureeJTrav;var t=this.shadowRoot.querySelector("#input-am-in");t.addEventListener("iron-input-validate",e=>{t.invalid||""==t.value||void 0==t.value||(this.momentAmIn=this._momentSplitColon(t.value),this.momentAmIn._isValid&&(this.momentClockHFin=moment(this.momentAmIn),this.momentClockHFin.add(this.hDureeJTrav,"h").add(this.mDureeJTrav,"m").add(this.intervalDej,"m"),this.clockHFin=Number(this.momentClockHFin.format("x")),void 0!=this.momentPmOut&&this.momentPmOut._isValid&&m.validate()))});var e=this.shadowRoot.querySelector("#input-am-out");e.addEventListener("iron-input-validate",t=>{e.invalid||""==e.value||void 0==e.value||(this.momentAmOut=this._momentSplitColon(e.value),this.momentAmOut._isValid&&void 0!=this.momentPmIn&&this.momentPmIn._isValid&&i.validate())});var i=this.shadowRoot.querySelector("#input-pm-in");i.addEventListener("iron-input-validate",e=>{if(!i.invalid&&""!=i.value&&void 0!=i.value&&(this.momentPmIn=this._momentSplitColon(i.value),this.momentPmIn._isValid)){if(void 0!=this.momentAmOut&&this.momentAmOut._isValid){let t=Math.round(moment.duration(this.momentPmIn.diff(this.momentAmOut)).asMinutes());t<this.intervalDejMin?this.intervalDej=this.intervalDejMin:this.intervalDej=t}t.validate()}});var m=this.shadowRoot.querySelector("#input-pm-out");m.addEventListener("iron-input-validate",t=>{m.invalid||""==m.value||void 0==m.value||(this.momentPmOut=this._momentSplitColon(m.value),this.momentPmOut._isValid&&void 0!=this.momentClockHFin&&this.momentClockHFin._isValid&&(this.clockHFinCompteur=this.momentPmOut.diff(this.momentClockHFin)))})}}customElements.define(CdItime.is,CdItime);</script> </dom-module>